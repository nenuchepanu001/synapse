use nyc_taxi_ldw;


SELECT TOP(100)
         td.year
        ,td.month
        ,tz.borough
        ,CONVERT(DATE,td.lpep_pickup_datetime) as trip_date
        ,cal.day_name as trip_day
        ,CASE WHEN cal.day_name IN ('Saturday','Sunday') THEN 'Y' ELSE 'N' END AS trip_day_weekend_ind
        ,SUM(CASE WHEN pt.description= 'Credit card' THEN 1 ELSE 0 END) as card_trip_count
        ,SUM(CASE WHEN pt.description= 'Cash' THEN 1 ELSE 0 END) as cash_trip_count
    FROM silver.vw_trip_data_green td
    JOIN silver.taxi_zone tz ON (td.PULocationID=tz.location_id)
    JOIN silver.calendar cal ON (cal.date = CONVERT(DATE,td.lpep_pickup_datetime))
    JOIN silver.payment_type pt ON (td.payment_type = pt.payment_type)
WHERE td.year='2020' and td.month='01'
GROUP BY td.year
        ,td.month
        ,tz.borough
        ,CONVERT(DATE,td.lpep_pickup_datetime)
        ,cal.day_name
